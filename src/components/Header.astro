---
interface Props {
  pathname: string
}

const { pathname } = Astro.props
const isHome = pathname === "/"
---

<header class="mt-6 md:mt-16">
  <nav class="flex items-center justify-between">
    <a
      href="/"
      class="-ml-3 inline-flex h-9 items-center justify-center rounded-md px-3 text-base font-medium transition-colors hover:bg-accent hover:text-accent-foreground"
    >
      {isHome ? <h1>Max Petretta</h1> : "Max Petretta"}
    </a>

    <div class="flex items-center space-x-5">
      {
        !isHome && (
          <span class="inline-flex h-9 items-center justify-center rounded-md px-3 text-sm font-medium text-muted-foreground">
            {pathname}
          </span>
        )
      }

      <button
        id="theme-toggle"
        type="button"
        class="relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent bg-orange-400 dark:bg-zinc-700 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"
        role="switch"
        aria-checked="false"
        aria-label="Toggle theme"
      >
        <span
          id="theme-toggle-thumb"
          class="pointer-events-none block h-4 w-4 translate-x-0 rounded-full bg-background shadow-lg ring-0 transition-transform"
        >
        </span>
      </button>
    </div>
  </nav>
</header>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById("theme-toggle")
    const thumb = document.getElementById("theme-toggle-thumb")

    if (!toggle || !thumb) return

    function updateToggle() {
      const isDark = document.documentElement.classList.contains("dark")
      toggle?.setAttribute("aria-checked", (!isDark).toString())
      if (isDark) {
        thumb?.classList.remove("translate-x-4")
        thumb?.classList.add("translate-x-0")
      } else {
        thumb?.classList.remove("translate-x-0")
        thumb?.classList.add("translate-x-4")
      }
    }

    updateToggle()

    toggle.addEventListener("click", () => {
      const isDark = document.documentElement.classList.contains("dark")
      document.documentElement.classList.add("no-transition")

      if (isDark) {
        document.documentElement.classList.remove("dark")
        localStorage.theme = "light"
      } else {
        document.documentElement.classList.add("dark")
        localStorage.theme = "dark"
      }

      const themeColor = isDark ? "#ffffff" : "#09090b"
      const meta = document.querySelector('meta[name="theme-color"]')
      if (meta) meta.setAttribute("content", themeColor)

      requestAnimationFrame(() => {
        document.documentElement.classList.remove("no-transition")
        updateToggle()
      })
    })
  }

  initThemeToggle()
  document.addEventListener("astro:after-swap", initThemeToggle)
</script>

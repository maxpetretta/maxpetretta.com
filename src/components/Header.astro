---
interface Props {
  pathname: string
}

const { pathname } = Astro.props
const isHome = pathname === "/"
---

<header class="mt-6 md:mt-16">
  <nav class="flex items-center justify-between">
    <a
      href="/"
      class="-ml-3 inline-flex h-9 items-center justify-center rounded-md px-3 text-base font-medium transition-colors hover:bg-accent hover:text-accent-foreground"
    >
      {isHome ? <h1>Max Petretta</h1> : "Max Petretta"}
      {!isHome && <><span class="mx-2 text-2xl font-extralight text-muted-foreground">/</span><span class="text-sm font-normal text-muted-foreground">{pathname.slice(1).replace(/\/$/, '')}</span></>}
    </a>

    <div class="flex items-center">

      <button
        id="theme-toggle"
        type="button"
        class="relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent bg-brand dark:bg-muted transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"
        role="switch"
        aria-label="Toggle theme"
      >
        <span
          id="theme-toggle-thumb"
          class="pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform"
        >
        </span>
      </button>
      <script is:inline>
        function syncToggleState() {
          const isDark = document.documentElement.classList.contains("dark")
          const thumb = document.getElementById("theme-toggle-thumb")
          const toggle = document.getElementById("theme-toggle")
          if (thumb) thumb.style.transform = isDark ? "translateX(0)" : "translateX(1rem)"
          if (toggle) toggle.setAttribute("aria-checked", (!isDark).toString())
        }

        syncToggleState()
        document.addEventListener("astro:after-swap", syncToggleState)
      </script>
    </div>
  </nav>
</header>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById("theme-toggle")
    const thumb = document.getElementById("theme-toggle-thumb")

    if (!toggle || !thumb) return

    toggle.addEventListener("click", () => {
      const isDark = document.documentElement.classList.contains("dark")
      document.documentElement.classList.add("no-transition")

      if (isDark) {
        document.documentElement.classList.remove("dark")
        localStorage.theme = "light"
        thumb.style.transform = "translateX(1rem)"
      } else {
        document.documentElement.classList.add("dark")
        localStorage.theme = "dark"
        thumb.style.transform = "translateX(0)"
      }

      toggle.setAttribute("aria-checked", isDark.toString())

      const themeColor = isDark ? "#ffffff" : "#09090b"
      const meta = document.querySelector('meta[name="theme-color"]')
      if (meta) meta.setAttribute("content", themeColor)

      requestAnimationFrame(() => {
        document.documentElement.classList.remove("no-transition")
      })
    })
  }

  initThemeToggle()
  document.addEventListener("astro:after-swap", initThemeToggle)
</script>

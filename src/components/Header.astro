---
interface Props {
  pathname: string
}

const { pathname } = Astro.props
const isHome = pathname === "/"
---

<header class="mt-6 md:mt-16">
  <nav class="flex items-center justify-between">
    <a
      href="/"
      class="-ml-3 inline-flex h-9 items-center justify-center rounded-md px-3 text-base font-medium hover:bg-accent hover:text-accent-foreground"
    >
      {isHome ? <h1>Max Petretta</h1> : "Max Petretta"}
      {!isHome && <><span class="mx-2 text-2xl font-extralight text-muted-foreground">/</span><span class="text-sm font-normal text-muted-foreground">{pathname.slice(1).replace(/\/$/, '')}</span></>}
    </a>

    <div class="flex items-center">
      <button
        id="theme-toggle"
        type="button"
        class="relative inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent bg-brand dark:bg-muted transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"
        role="switch"
        aria-label="Toggle theme"
      >
        <span
          id="theme-toggle-thumb"
          class="pointer-events-none block h-4 w-4 translate-x-4 rounded-full bg-background shadow-lg ring-0 transition-transform dark:translate-x-0"
        >
        </span>
      </button>
    </div>
  </nav>
</header>

<script>
  import { initTheme } from "@/lib/theme"

  // Preserve theme during View Transitions (before swap to prevent flash)
  document.addEventListener("astro:before-swap", (e) => {
    const isDark = document.documentElement.classList.contains("dark")
    e.newDocument.documentElement.classList.toggle("dark", isDark)
  })

  initTheme()
  document.addEventListener("astro:page-load", initTheme)
</script>
